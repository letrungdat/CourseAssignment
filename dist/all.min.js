var app=angular.module("myApp",["firebase","ngRoute","ngAnimate"]);app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"template/home.html",controller:"homeController"}).when("/team",{templateUrl:"template/team.html",controller:"teamController"}).when("/table",{templateUrl:"template/table.html",controller:"tableController"}).when("/player/:num",{templateUrl:"template/player.html",controller:"playerController"}).when("/calendar",{templateUrl:"template/calendar.html",controller:"calendarController"}).otherwise({redirectTo:"/"})}]),app.controller("MyController",["$scope","$firebaseArray",function(e,t){e.teamName="Manchester United",e.pageIcon="image/team/manu-logo.png",e.leagueLogo="image/Premier_League_logo.svg",e.leagueName="Barclays Preimer League",e.page={},e.page.title="",e.menuClick=function(){$("#container").toggleClass("open")}}]),app.controller("homeController",["$scope","$firebaseArray","$timeout",function(e,t,a){var r={},o=new Firebase("https://cscassignment.firebaseio.com/");e.page.title="Home",e.news=t(o.child("news")),o.child("teamCalendar").orderByChild("date").startAt(moment().format("DD/MM/YYYY")).limitToFirst(3).once("value",function(t){a(function(){r=t.val();for(var a in r)r[a].date=moment(r[a].date,"DD/MM/YYYY").format("MMM DD"),r[a].time=moment(r[a].time,"HH:mm").format("hh:mma");e.teamCalendars=r})}),e.players=t(o.child("teamMembers").orderByChild("number"))}]),app.controller("playerController",["$scope","$firebaseArray","$routeParams",function(e,t,a){var r=new Firebase("https://cscassignment.firebaseio.com/"),o=a.num,n={};e.players=t(r.child("teamMembers").orderByChild("number").equalTo(parseInt(o))),r.child("teamMembers").orderByChild("number").equalTo(parseInt(o)).on("value",function(t){n=t.val();for(var a in n)e.page.title=n[a].name})}]),app.controller("teamController",["$scope","$firebaseArray",function(e,t){var a=new Firebase("https://cscassignment.firebaseio.com/");e.page.title="Squad",e.goalkeepers=t(a.child("teamMembers").orderByChild("type").equalTo("G")),e.defenders=t(a.child("teamMembers").orderByChild("type").equalTo("D")),e.midfielders=t(a.child("teamMembers").orderByChild("type").equalTo("M")),e.strikers=t(a.child("teamMembers").orderByChild("type").equalTo("S"))}]),app.controller("tableController",["$scope","$firebaseArray",function(e,t){e.page.title="TABLE";var a=new Firebase("https://cscassignment.firebaseio.com/leagueTable");e.table=t(a.orderByChild("position"))}]),app.controller("calendarController",["$scope","$firebaseArray","mainService","$timeout",function(e,t,a,r){e.page.title="Calendar";var o={},n={},l=new Firebase("https://cscassignment.firebaseio.com/teamCalendar");e.day=moment().date,e.selected=a._removeTime(e.selected||moment()),e.month=e.selected.clone();var m=e.selected.clone();m.date(1),a._removeTime(m.day(0)),e.select=function(t){e.selected=t.date},l.once("value",function(t){o=t.val(),a._buildMonth(e,m,e.month,o)}),l.orderByChild("date").startAt(moment().format("DD/MM/YYYY")).once("value",function(t){r(function(){n=t.val();for(var a in n)n[a].date=moment(n[a].date,"DD/MM/YYYY").format("MMM DD"),n[a].time=moment(n[a].time,"HH:mm").format("hh:mma");e.teamCalendars=n})}),e.changeView=function(e){a._changeView(e)},e.next=function(){var t=e.month.clone();a._removeTime(t.month(t.month()+1).date(1).day(0)),e.month.month(e.month.month()+1),a._buildMonth(e,t,e.month,o)},e.previous=function(){var t=e.month.clone();a._removeTime(t.month(t.month()-1).date(1).day(0)),e.month.month(e.month.month()-1),a._buildMonth(e,t,e.month,o)}}]),app.service("mainService",function(){function e(e,r,o){for(var n=[],l=0;7>l;l++){var m=!1,i="";t(e,o)&&(m=!0,i=a(e,o)),n.push({name:e.format("dd").substring(0,1),number:e.date(),isCurrentMonth:e.month()===r.month(),isToday:e.isSame(new Date,"day"),date:e,haveMatch:m,match:i}),e=e.clone(),e.add(1,"d")}return n}function t(e,t){var a=!1;for(var r in t)if(t.hasOwnProperty(r)){var o=t[r].date;e.isSame(moment(o,"DD/MM/YYYY"))&&(a=!0)}return a}function a(e,t){for(var a in t)if(t.hasOwnProperty(a)){var r=t[a].date;if(e.isSame(moment(r,"DD/MM/YYYY")))return t[a]}return""}var r=!0;this._removeTime=function(e){return e.hour(0).minute(0).second(0).millisecond(0)},this._buildMonth=function(t,a,r,o){t.weeks=[];for(var n=!1,l=a.clone(),m=l.month(),i=0;!n;)t.weeks.push({days:e(l.clone(),r,o)}),l.add(1,"w"),n=i++>2&&m!==l.month(),m=l.month()},this._changeView=function(e){"calendar"===e?r||($("#calendar-view").toggleClass("show"),$("#list-view").toggleClass("show"),r=!0):r&&($("#calendar-view").toggleClass("show"),$("#list-view").toggleClass("show"),r=!1)}});