var app=angular.module("myApp",["firebase","ngRoute","ngAnimate"]);app.config(["$routeProvider",function(e){e.when("/",{templateUrl:"template/home.html",controller:"homeController"}).when("/news",{templateUrl:"template/news.html",controller:"newsController"}).when("/team",{templateUrl:"template/team.html",controller:"teamController"}).when("/table",{templateUrl:"template/table.html",controller:"tableController"}).when("/player/:num",{templateUrl:"template/player.html",controller:"playerController"}).when("/calendar",{templateUrl:"template/calendar.html",controller:"calendarController"}).otherwise({redirectTo:"/"})}]),app.controller("MyController",["$scope","$firebaseArray",function(e,t){e.teamName="Manchester United",e.pageIcon="image/team/manu-logo.png",e.leagueLogo="image/Premier_League_logo.svg",e.leagueName="Barclays Preimer League",e.page={},e.page.title="",e.menuClick=function(){$("#container").toggleClass("open")}}]),app.controller("homeController",["$scope","$firebaseArray","$timeout","mainService",function(e,t,n,r){var o={},a=new Firebase("https://cscassignment.firebaseio.com/");e.page.title="Home",e.news=t(a.child("news").limitToFirst(5)),a.child("teamCalendar").orderByChild("date").once("value",function(t){n(function(){o=t.val();for(var n in o)o[n].date=moment(o[n].date,"DD/MM/YYYY").format("MMM DD"),o[n].time=moment(o[n].time,"HH:mm").format("hh:mma");e.teamCalendars=r.sortByDate(o).slice(0,3)})});var l={},i=[];a.child("teamMembers").once("value",function(t){n(function(){l=t.val(),i=r.convertToArray(l),e.players=i})})}]),app.controller("newsController",["$scope","$firebaseArray","mainService","$timeout",function(e,t,n,r){e.page.title="News";var o={},a=[],l=[],m=4,s=3,c=new Firebase("https://cscassignment.firebaseio.com/");c.child("news").once("value",function(e){r(function(){for(o=e.val(),a=n.convertToArray(o),i=0;i<m;i++)l.push(a[i])})}),e.news=l,e.showMore=function(){var e=s+m;if(s<a.length&&e<a.length)for(var t=s+1;e>t;t++)l.push(a[t]),s++;else if(s<a.length&&e>a.length){for(var n=s+1;n<a.length;n++)l.push(a[n]),s++;$(".showMoreBtn").addClass("hide")}else $(".showMoreBtn").addClass("hide")}}]),app.controller("playerController",["$scope","$firebaseArray","$routeParams",function(e,t,n){var r=new Firebase("https://cscassignment.firebaseio.com/"),o=n.num,a={};e.players=t(r.child("teamMembers").orderByChild("number").equalTo(parseInt(o))),r.child("teamMembers").orderByChild("number").equalTo(parseInt(o)).on("value",function(t){a=t.val();for(var n in a)e.page.title=a[n].name})}]),app.controller("teamController",["$scope","$firebaseArray",function(e,t){var n=new Firebase("https://cscassignment.firebaseio.com/");e.page.title="Squad",e.goalkeepers=t(n.child("teamMembers").orderByChild("type").equalTo("G")),e.defenders=t(n.child("teamMembers").orderByChild("type").equalTo("D")),e.midfielders=t(n.child("teamMembers").orderByChild("type").equalTo("M")),e.strikers=t(n.child("teamMembers").orderByChild("type").equalTo("S"))}]),app.controller("tableController",["$scope","$firebaseArray",function(e,t){e.page.title="TABLE";var n=new Firebase("https://cscassignment.firebaseio.com/leagueTable");e.table=t(n.orderByChild("position"))}]),app.controller("calendarController",["$scope","$firebaseArray","mainService","$timeout",function(e,t,n,r){e.page.title="Calendar";var o={},a={},l=new Firebase("https://cscassignment.firebaseio.com/teamCalendar");e.day=moment().date,e.selected=n._removeTime(e.selected||moment()),e.month=e.selected.clone();var i=e.selected.clone();i.date(1),n._removeTime(i.day(0)),e.select=function(t){e.selected=t.date},l.once("value",function(t){o=t.val(),n._buildMonth(e,i,e.month,o)}),l.orderByChild("date").once("value",function(t){r(function(){a=t.val();for(var r in a)a[r].date=moment(a[r].date,"DD/MM/YYYY").format("MMM DD"),a[r].time=moment(a[r].time,"HH:mm").format("hh:mma");e.teamCalendars=n.sortByDate(a)})}),e.changeView=function(e){n._changeView(e)},e.next=function(){var t=e.month.clone();n._removeTime(t.month(t.month()+1).date(1).day(0)),e.month.month(e.month.month()+1),n._buildMonth(e,t,e.month,o)},e.previous=function(){var t=e.month.clone();n._removeTime(t.month(t.month()-1).date(1).day(0)),e.month.month(e.month.month()-1),n._buildMonth(e,t,e.month,o)}}]),app.controller("carouselCtrl",["$scope","$firebaseArray","mainService","$timeout",function(e,t,n,r){var o={},a=[],l=new Firebase("https://cscassignment.firebaseio.com/");l.child("news").once("value",function(t){r(function(){o=t.val(),a=n.convertToArray(o),e.items2=a})})}]),app.directive("owlCarousel",function(){return{restrict:"E",transclude:!1,link:function(e){e.initCarousel=function(t){var n={},r=e.$eval($(t).attr("data-options"));for(var o in r)n[o]=r[o];$(t).owlCarousel(n)}}}}).directive("owlCarouselItem",[function(){return{restrict:"A",transclude:!1,link:function(e,t){e.$last&&e.initCarousel(t.parent())}}}]),app.service("mainService",function(){function e(e,r,o){for(var a=[],l=0;7>l;l++){var i=!1,m="";t(e,o)&&(i=!0,m=n(e,o)),a.push({name:e.format("dd").substring(0,1),number:e.date(),isCurrentMonth:e.month()===r.month(),isToday:e.isSame(new Date,"day"),date:e,haveMatch:i,match:m}),e=e.clone(),e.add(1,"d")}return a}function t(e,t){var n=!1;for(var r in t)if(t.hasOwnProperty(r)){var o=t[r].date;e.isSame(moment(o,"DD/MM/YYYY"))&&(n=!0)}return n}function n(e,t){for(var n in t)if(t.hasOwnProperty(n)){var r=t[n].date;if(e.isSame(moment(r,"DD/MM/YYYY")))return t[n]}return""}var r=!0;this._removeTime=function(e){return e.hour(0).minute(0).second(0).millisecond(0)},this._buildMonth=function(t,n,r,o){t.weeks=[];for(var a=!1,l=n.clone(),i=l.month(),m=0;!a;)t.weeks.push({days:e(l.clone(),r,o)}),l.add(1,"w"),a=m++>2&&i!==l.month(),i=l.month()},this._changeView=function(e){"calendar"===e?r||($("#calendar-view").toggleClass("show"),$("#list-view").toggleClass("show"),r=!0):r&&($("#calendar-view").toggleClass("show"),$("#list-view").toggleClass("show"),r=!1)},this.sortByDate=function(e){for(var t=$.map(e,function(e,t){return[e]}),n=0;n<t.length;n++)moment()>moment(t[n].date,"MMM DD")&&(t.splice(n,1),n--);return t.sort(function(e,t){return moment(e.date,"MMM DD")<moment(t.date,"MMM DD")?-1:moment(e.date,"MMM DD")>moment(t.date,"MMM DD")?1:0}),t},this.convertToArray=function(e){return $.map(e,function(e,t){return[e]})}});